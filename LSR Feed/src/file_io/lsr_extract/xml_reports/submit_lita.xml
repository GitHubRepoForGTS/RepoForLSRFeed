<?xml version="1.0" encoding="UTF-8"?>



<!--                                                 -->

<!--    Break-fix - Report SQLs DTD and XML          -->

<!--                                                 -->



<!-- Modification History                            	 		-->

<!-- 01/06/2005 | KW | First Cut					-->

<!-- 01/09/2005 | KW | Moved DTD to external file LSRExtract.dtd	-->

<!-- 03/28/2006 | VM | C2246 Changed SQl for each report to add new columns             -->

<!--                   C2246 Changed the export file name for all reports               -->

<!--                   C2246 Changed the date format for all reports                    -->

<!--                   C3220 Using new views and new effective period end date          -->

<!--                   V04 Added ECA to end of parts, rcs and install               -->

<!--                   V05 Queries changed to exclude transactions that may have a STATUS = CANCEL  -->

<!-- 07/14/2008 | VM | V06 Modified Parts Query to pull summarized ACE credits  -->

<!-- 2009-05-01 | VM | V17 Added section PL_PARTS_FEE_CR for 1 time calculation of Parts Management Fee credit -->

<!-- 2009-05-01 | VM | V18 Change the capture period to use min LEN_DATA_REC column = N -->

<!-- 2009-12-06 | VM | Added Transaction Reversal for PL_DETAIL_CR -->

<!-- 2009-12-08 | VM | Removed the use of DIST_COST in parts extract in favor of BILLING_RATE -->

<!-- 2010-06-01 | VM | Will use our Province column in the STATE field -->

<!-- 2010-09-23 | VM | Added 004 to credit code for ACE -->

<!-- 2010-11-02 | VM | Removed the section generating derived parts transactions and removed LL0 from ISC queries -->

<!-- 2011-02-22 | VM | Added ECA column to parts and rcs and install  -->

<!-- 2011-04-04 | VM | Blanked out the company name field-->





<!DOCTYPE reports SYSTEM "./../../dtd/LSRExtract.dtd">



<reports>



  <!-- Bill to Lenovo (includes new and resubmitted transactions -->



  <report includeHeader="Custom">

    <fileName text="onsitebfservice_CA.csv" />

    <dateFormat text="YYYYMMDD" />

    <timeFormat text="HH:MM:SS" />

    <SQL text="

	WITH SUB1(CAPTURE_PERIOD) AS (

	SELECT MIN(PERIOD_END_DTE) FROM LENOVO.PERIOD_DATES WHERE LEN_DATA_REC = 'N' 

	)

	SELECT 	MACH,SERIAL,LLI,EFFECTIVE_PERIOD,SERVICE_DTE,REPLACE(DOCNUM,'-','') AS DOCNUM,ECA,POSTAL_CDE,COUNTRY_CDE,WW_CDE,

	CASE WHEN DET_PERIOD_END_DTE IN (SELECT CAPTURE_PERIOD FROM SUB1)THEN 'N' ELSE 'R' END AS RESUBMIT_IND,

	LENOVO_KEY,TRANSACTION_ID,HOURS,COMPANY_NAME,CUSTOMER_PHONE,ADDRESS_FLOOR,ADDRESS_STREET,DISTRICT,CITY,PROVINCE_NAME,WESSN_DOCNUM

	FROM LENOVO.BF_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD IN (SELECT CAPTURE_PERIOD FROM SUB1) AND DETAIL_STATUS NOT IN ('CANCEL', 'BACKLOG')

	" />

  </report>



  <report includeHeader="Custom">
	
    <fileName text="depotrepair_CA.csv" />

    <dateFormat text="YYYYMMDD" />

    <timeFormat text="HH:MM:SS" />

    <SQL text="

	WITH SUB1(CAPTURE_PERIOD) AS (

	SELECT MIN(PERIOD_END_DTE) FROM LENOVO.PERIOD_DATES WHERE LEN_DATA_REC = 'N' 

	)

	SELECT 	MACH,SERIAL,LLI,EFFECTIVE_PERIOD,REPLACE(DOCNUM,'-','') AS DOCNUM,ECA,POSTAL_CDE,COUNTRY_CDE,WW_CDE,

	CASE WHEN DET_PERIOD_END_DTE IN (SELECT CAPTURE_PERIOD FROM SUB1)THEN 'N' ELSE 'R' END AS RESUBMIT_IND,

	LENOVO_KEY,TRANSACTION_ID,HOURS,'' as COMPANY_NAME,CUSTOMER_PHONE,ADDRESS_FLOOR,ADDRESS_STREET,DISTRICT,CITY,PROVINCE_NAME,WESSN_DOCNUM,SERV_PERFORMED_DTE

	FROM LENOVO.DR_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD IN (SELECT CAPTURE_PERIOD FROM SUB1) AND DETAIL_STATUS NOT IN ('CANCEL', 'BACKLOG')

    " />

  </report>



  <report includeHeader="Custom">

    <fileName text="installation_CA.csv" />

    <dateFormat text="YYYYMMDD" />

    <timeFormat text="HH:MM:SS" />

    <SQL text="

	WITH SUB1(CAPTURE_PERIOD) AS (

	SELECT MIN(PERIOD_END_DTE) FROM LENOVO.PERIOD_DATES WHERE LEN_DATA_REC = 'N' 

	)

    	SELECT 	MACH,SERIAL,LLI,EFFECTIVE_PERIOD,SERVICE_DTE,REPLACE(DOCNUM,'-','') AS DOCNUM,POSTAL_CDE,COUNTRY_CDE,WW_CDE,

    	CASE WHEN DET_PERIOD_END_DTE IN (SELECT CAPTURE_PERIOD FROM SUB1)THEN 'N' ELSE 'R' END AS RESUBMIT_IND,

    	LENOVO_KEY,TRANSACTION_ID,'' as COMPANY_NAME,CUSTOMER_PHONE,ADDRESS_FLOOR,ADDRESS_STREET,DISTRICT,CITY,PROVINCE_NAME,WESSN_DOCNUM, ECA as ECA

	FROM LENOVO.INS_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD IN (SELECT CAPTURE_PERIOD FROM SUB1) AND DETAIL_STATUS NOT IN ('CANCEL', 'BACKLOG')

    " />

  </report>



  <report includeHeader="Custom">
	<fileType text="xls" title="partslogistics_CA"/>
    <fileName text="partslogistics_CA.csv" />

    <dateFormat text="YYYYMMDD" />

    <timeFormat text="HH:MM:SS" />

    <SQL text="

	WITH SUB1(CAPTURE_PERIOD) AS (

	SELECT MIN(PERIOD_END_DTE) FROM LENOVO.PERIOD_DATES WHERE LEN_DATA_REC = 'N' 

	),

	

	RCS_ACE_CREDITS(MACH,LLI,EFFECTIVE_PERIOD,SHIP_DTE,DOCNUM,CLAIM_NUM,PARTNO,PARTQTY,PART_COST,DIST_COST,PART_CREDIT,POSTAL_CDE,ORDER_NUM,COUNTRY_CDE,WW_CDE,RESUBMIT_IND,LENOVO_KEY,TRANSACTION_ID,SERIAL,COMPANY_NAME,CUSTOMER_PHONE,ADDRESS_FLOOR,ADDRESS_STREET,DISTRICT,CITY,STATE, ECA) AS (

	SELECT 'DSKT',  'L00', 

	(SELECT MIN(PERIOD_END_DTE) FROM LENOVO.PERIOD_DATES WHERE LEN_DATA_REC = 'N' ) AS EFFECTIVE_PERIOD,

	(SELECT MIN(PERIOD_END_DTE) FROM LENOVO.PERIOD_DATES WHERE LEN_DATA_REC = 'N' ) AS SHIP_DTE,

	'RCS', CAST(NULL AS CHAR(1)), CAST(NULL AS CHAR(1)), -1, VALUE(SUM(BILLING_RATE * -1 * TRANSACTION_CNT), 0), 0, 0, ' ', CAST(NULL AS CHAR(1)), '649', '99', 'N', CAST(NULL AS CHAR(1)), 

	(SELECT CAST(YEAR(PERIOD_END_DTE) AS CHAR(4)) || (RIGHT('00'|| RTRIM(CAST(MONTH(PERIOD_END_DTE) AS CHAR(2))), 2)) || (RIGHT('00'|| RTRIM(CAST(DAY(PERIOD_END_DTE) AS CHAR(2))), 2)) || 'RCS' FROM LENOVO.PERIOD_DATES WHERE YEAR = YEAR(CURRENT DATE - 1 MONTH) AND MONTH = MONTH(CURRENT DATE - 1 MONTH)) AS TRANSACTION_ID,

	CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),'TC107'

	FROM LENOVO.RCS_DETAIL_CR 

	WHERE PERIOD_END_DTE IN (SELECT CAPTURE_PERIOD FROM SUB1 ) AND 

	STATUS = 'CREDIT' AND 

	CREDIT_CDE IN ('002', '004') AND 

	BILLABLE = 'Y' 

	),



	BF_ACE_CREDITS(MACH,LLI,EFFECTIVE_PERIOD,SHIP_DTE,DOCNUM,CLAIM_NUM,PARTNO,PARTQTY,PART_COST,DIST_COST,PART_CREDIT,POSTAL_CDE,ORDER_NUM,COUNTRY_CDE,WW_CDE,RESUBMIT_IND,LENOVO_KEY,TRANSACTION_ID,SERIAL,COMPANY_NAME,CUSTOMER_PHONE,ADDRESS_FLOOR,ADDRESS_STREET,DISTRICT,CITY,STATE, ECA) AS (

	SELECT 'DSKT',  'L00', 

	(SELECT MIN(PERIOD_END_DTE) FROM LENOVO.PERIOD_DATES WHERE LEN_DATA_REC = 'N' ) AS EFFECTIVE_PERIOD,

	(SELECT MIN(PERIOD_END_DTE) FROM LENOVO.PERIOD_DATES WHERE LEN_DATA_REC = 'N' ) AS SHIP_DTE,

	'ON SITE', CAST(NULL AS CHAR(1)), CAST(NULL AS CHAR(1)), -1, VALUE(SUM(BILLING_RATE * -1 * TRANSACTION_CNT), 0), 0, 0, ' ', CAST(NULL AS CHAR(1)), '649', '99', 'N', CAST(NULL AS CHAR(1)), 

	(SELECT CAST(YEAR(PERIOD_END_DTE) AS CHAR(4)) || (RIGHT('00'|| RTRIM(CAST(MONTH(PERIOD_END_DTE) AS CHAR(2))), 2)) || (RIGHT('00'|| RTRIM(CAST(DAY(PERIOD_END_DTE) AS CHAR(2))), 2)) || 'ONSITE' FROM LENOVO.PERIOD_DATES WHERE YEAR = YEAR(CURRENT DATE - 1 MONTH) AND MONTH = MONTH(CURRENT DATE - 1 MONTH)) AS TRANSACTION_ID,

	CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),'TC107'

	FROM LENOVO.BF_DETAIL_CR 

	WHERE PERIOD_END_DTE IN (SELECT CAPTURE_PERIOD FROM SUB1 ) AND 

	STATUS = 'CREDIT' AND 

	CREDIT_CDE IN ('002', '004') AND 

	BILLABLE = 'Y' 

	),



	PL_ACE_CREDITS(MACH,LLI,EFFECTIVE_PERIOD,SHIP_DTE,DOCNUM,CLAIM_NUM,PARTNO,PARTQTY,PART_COST,DIST_COST,PART_CREDIT,POSTAL_CDE,ORDER_NUM,COUNTRY_CDE,WW_CDE,RESUBMIT_IND,LENOVO_KEY,TRANSACTION_ID,SERIAL,COMPANY_NAME,CUSTOMER_PHONE,ADDRESS_FLOOR,ADDRESS_STREET,DISTRICT,CITY,STATE, ECA) AS (

	SELECT 'DSKT',  'L00', 

	(SELECT MIN(PERIOD_END_DTE) FROM LENOVO.PERIOD_DATES WHERE LEN_DATA_REC = 'N' ) AS EFFECTIVE_PERIOD,

	(SELECT MIN(PERIOD_END_DTE) FROM LENOVO.PERIOD_DATES WHERE LEN_DATA_REC = 'N' ) AS SHIP_DTE,

	'DISTRIBUTION', CAST(NULL AS CHAR(1)), CAST(NULL AS CHAR(1)), -1, VALUE(SUM(BILLING_RATE * -1 * TRANSACTION_CNT), 0), 0, 0, ' ', CAST(NULL AS CHAR(1)), '649', '99', 'N', CAST(NULL AS CHAR(1)), 

	(SELECT CAST(YEAR(PERIOD_END_DTE) AS CHAR(4)) || (RIGHT('00'|| RTRIM(CAST(MONTH(PERIOD_END_DTE) AS CHAR(2))), 2)) || (RIGHT('00'|| RTRIM(CAST(DAY(PERIOD_END_DTE) AS CHAR(2))), 2)) || 'DISTRIBUTION' FROM LENOVO.PERIOD_DATES WHERE YEAR = YEAR(CURRENT DATE - 1 MONTH) AND MONTH = MONTH(CURRENT DATE - 1 MONTH)) AS TRANSACTION_ID,

	CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),'TC107'

	FROM LENOVO.PL_DETAIL_CR 

	WHERE PERIOD_END_DTE IN (SELECT CAPTURE_PERIOD FROM SUB1 ) AND 

	STATUS = 'CREDIT' AND 

	CREDIT_CDE IN ('002', '004') AND 

	BILLABLE = 'Y' 

	),

	

	PL_PARTS_FEE_CR(MACH,LLI,EFFECTIVE_PERIOD,SHIP_DTE,DOCNUM,CLAIM_NUM,PARTNO,PARTQTY,PART_COST,DIST_COST,PART_CREDIT,POSTAL_CDE,ORDER_NUM,COUNTRY_CDE,WW_CDE,RESUBMIT_IND,LENOVO_KEY,TRANSACTION_ID,SERIAL,COMPANY_NAME,CUSTOMER_PHONE,ADDRESS_FLOOR,ADDRESS_STREET,DISTRICT,CITY,STATE, ECA) AS (

	SELECT 'DSKT',  'L00', 

	(SELECT MIN(PERIOD_END_DTE) FROM LENOVO.PERIOD_DATES WHERE LEN_DATA_REC = 'N' ) AS EFFECTIVE_PERIOD,

	(SELECT MIN(PERIOD_END_DTE) FROM LENOVO.PERIOD_DATES WHERE LEN_DATA_REC = 'N' ) AS SHIP_DTE,

	'ACE PART FEE CREDIT', CAST(NULL AS CHAR(1)), CAST(NULL AS CHAR(1)), -1, VALUE(SUM(PART_COST * -1), 0), 0, 0, ' ', CAST(NULL AS CHAR(1)), '649', '99', 'N', CAST(NULL AS CHAR(1)), 

	(SELECT CAST(YEAR(PERIOD_END_DTE) AS CHAR(4)) || (RIGHT('00'|| RTRIM(CAST(MONTH(PERIOD_END_DTE) AS CHAR(2))), 2)) || (RIGHT('00'|| RTRIM(CAST(DAY(PERIOD_END_DTE) AS CHAR(2))), 2)) || 'PARTS_FEE_CR' FROM LENOVO.PERIOD_DATES WHERE YEAR = YEAR(CURRENT DATE - 1 MONTH) AND MONTH = MONTH(CURRENT DATE - 1 MONTH)) AS TRANSACTION_ID,

	CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),CAST(NULL AS CHAR(1)),'TC107'

	FROM LENOVO.PL_DETAIL_CR 

	WHERE PERIOD_END_DTE IN (SELECT CAPTURE_PERIOD FROM SUB1 ) AND 

	STATUS = 'CREDIT' AND 

	CREDIT_CDE = '003' AND 

	BILLABLE = 'Y' 

	)	

	

	

	SELECT * FROM PL_ACE_CREDITS WHERE PART_COST &lt; 0

	UNION ALL

	SELECT * FROM BF_ACE_CREDITS WHERE PART_COST &lt; 0

	UNION ALL

	SELECT * FROM RCS_ACE_CREDITS WHERE PART_COST &lt; 0

	UNION ALL

	SELECT * FROM PL_PARTS_FEE_CR WHERE PART_COST &lt; 0

	UNION ALL

	SELECT MACH,LLI,PERIOD_END_DTE,SHIP_DTE,REPLACE(DOCNUM,'-','') AS DOCNUM,REPLACE(CLAIM_NUM,'-','') AS CLAIM_NUM,PARTNO,PARTQTY,PART_COST,BILLING_RATE,PART_CREDIT,POSTAL_CDE,ORDER_NUM,COUNTRY_CDE,WW_CDE,

	'C' AS RESUBMIT_IND,

	CAST(NULL AS CHAR(1)),TRANSACTION_ID,SERIAL,'' as COMPANY_NAME,CUSTOMER_PHONE,ADDRESS_FLOOR,ADDRESS_STREET,DISTRICT,CITY,PROVINCE_NAME, '' as ECA

	FROM LENOVO.PL_DETAIL_CR 

	WHERE PERIOD_END_DTE IN (SELECT CAPTURE_PERIOD FROM SUB1) AND STATUS = 'CREDIT' AND CREDIT_CDE = '001'

	

	UNION ALL

	

    	SELECT MACH,LLI,EFFECTIVE_PERIOD,SHIP_DTE,REPLACE(DOCNUM,'-','') AS DOCNUM,REPLACE(CLAIM_NUM,'-','') AS CLAIM_NUM,PARTNO,PARTQTY,PART_COST,BILLING_RATE,PART_CREDIT,POSTAL_CDE,ORDER_NUM,COUNTRY_CDE,WW_CDE,

    	CASE WHEN DET_PERIOD_END_DTE IN (SELECT CAPTURE_PERIOD FROM SUB1)THEN 'N' ELSE 'R' END AS RESUBMIT_IND,

    	LENOVO_KEY,TRANSACTION_ID,SERIAL,'' as COMPANY_NAME,CUSTOMER_PHONE,ADDRESS_FLOOR,ADDRESS_STREET,DISTRICT,CITY,PROVINCE_NAME, ECA as ECA

    	FROM LENOVO.PL_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD IN (SELECT CAPTURE_PERIOD FROM SUB1) AND DETAIL_STATUS NOT IN ('CANCEL', 'BACKLOG')

	

    " />

  </report>



  <report includeHeader="Custom">

    <fileName text="remotecustsupport_CA.csv" />

    <dateFormat text="YYYYMMDD" />

    <timeFormat text="HH:MM:SS" />

    <SQL text="

	WITH SUB1(CAPTURE_PERIOD) AS (

	SELECT MIN(PERIOD_END_DTE) FROM LENOVO.PERIOD_DATES WHERE LEN_DATA_REC = 'N' 

	)

	SELECT 	MACH,SERIAL,LLI,EFFECTIVE_PERIOD,REPLACE(DOCNUM,'-','') AS DOCNUM,POSTAL_CDE,COUNTRY_CDE,WW_CDE,

	CASE WHEN DET_PERIOD_END_DTE IN (SELECT CAPTURE_PERIOD FROM SUB1)THEN 'N' ELSE 'R' END AS RESUBMIT_IND,

	LENOVO_KEY,TRANSACTION_ID,'' as COMPANY_NAME,CUSTOMER_PHONE,ADDRESS_FLOOR,ADDRESS_STREET,DISTRICT,CITY,PROVINCE_NAME,RCS_CATEGORY,BRAND,WESSN_DOCNUM,SERV_PERFORMED_DTE, ECA as ECA

	FROM LENOVO.RCS_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD IN (SELECT CAPTURE_PERIOD FROM SUB1) AND DETAIL_STATUS NOT IN ('CANCEL', 'BACKLOG')

    " />

  </report>



<report includeHeader="Custom">

    <fileName text="manual_approval_CA.csv" />

    <dateFormat text="YYYYMMDD" />

    <timeFormat text="HH:MM:SS" />

    <SQL text="

	WITH PERIOD(PERIOD_END_DTE) AS (

	SELECT MIN(PERIOD_END_DTE) FROM LENOVO.PERIOD_DATES

	WHERE LEN_DATA_REC = 'N'

	),

	

	RESUBMITS(TYPE, TRANSACTION_ID) AS (

	SELECT 

	'BF RESUB' AS TYPE, TRANSACTION_ID

	FROM LENOVO.BF_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DET_PERIOD_END_DTE != (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DETAIL_STATUS != 'CANCEL'

	

	UNION ALL

	

	SELECT 

	'DR RESUB' AS TYPE, TRANSACTION_ID

	FROM LENOVO.DR_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DET_PERIOD_END_DTE != (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DETAIL_STATUS != 'CANCEL'

	

	UNION ALL

	

	SELECT 

	'RCS  RESUB' AS TYPE, TRANSACTION_ID

	FROM LENOVO.RCS_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DET_PERIOD_END_DTE != (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DETAIL_STATUS != 'CANCEL'

	

	UNION ALL

	

	SELECT 

	'PL  RESUB' AS TYPE, TRANSACTION_ID

	FROM LENOVO.PL_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DET_PERIOD_END_DTE != (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DETAIL_STATUS != 'CANCEL'

	),

	

	ISC(TYPE, TRANSACTION_ID, MACH, SERIAL) AS (

	SELECT 

	LLI || ' ISC' AS TYPE,

	TRANSACTION_ID, MACH, SERIAL

	FROM LENOVO.BF_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DET_PERIOD_END_DTE = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DETAIL_STATUS != 'CANCEL'

	AND LLI NOT IN ('L00', 'OTE') AND LLI IS NOT NULL

	

	UNION ALL

	

	SELECT 

	LLI || ' ISC' AS TYPE,

	TRANSACTION_ID, MACH, SERIAL

	FROM LENOVO.DR_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DET_PERIOD_END_DTE = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DETAIL_STATUS != 'CANCEL'

	AND LLI NOT IN ('L00', 'OTE') AND LLI IS NOT NULL

	

	UNION ALL 

	

	SELECT 

	LLI || ' ISC' AS TYPE,

	TRANSACTION_ID, MACH, SERIAL

	FROM LENOVO.RCS_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DET_PERIOD_END_DTE = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DETAIL_STATUS != 'CANCEL'

	AND LLI NOT IN ('L00', 'OTE') AND LLI IS NOT NULL

	

	UNION ALL

	

	SELECT 

	LLI || ' ISC' AS TYPE,

	TRANSACTION_ID, MACH, SERIAL

	FROM LENOVO.PL_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DET_PERIOD_END_DTE = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DETAIL_STATUS != 'CANCEL'

	AND LLI NOT IN ('L00', 'OTE') AND LLI IS NOT NULL

	),

	

	BLUEDESK_SCRAP_RESERVE_PHOENIX(TYPE, TRANSACTION_ID) AS (

	SELECT 

	CASE WHEN CLAIM_NUM = 'BLUEDESK' OR DOCNUM = 'BLUEDESK' OR SERIAL = 'XXXXXXX' THEN 'BLUEDESK' ELSE CASE WHEN WW_CDE = '47' THEN 'RESERVE' ELSE CASE WHEN WW_CDE IN ('48', '49') THEN 'SCRAP' ELSE CASE WHEN DATA_SOURCE IN ('JA', 'KD', 'KE', 'KF', 'LB') THEN 'PHOENIX' END END END END AS TYPE,

	TRANSACTION_ID

	FROM LENOVO.PL_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DET_PERIOD_END_DTE = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DETAIL_STATUS != 'CANCEL'

	AND LLI IN ('L00', 'LL0')

	AND ( DOCNUM = 'BLUEDESK' OR CLAIM_NUM = 'BLUEDESK' OR SERIAL = 'XXXXXXX' OR WW_CDE IN ('47', '48', '49') OR DATA_SOURCE IN ('JA', 'KD', 'KE', 'KF', 'LB') )

	),

	

	RCS_INFO(TYPE, TRANSACTION_ID) AS (

	SELECT 

	'INFO' AS TYPE,

	TRANSACTION_ID

	FROM LENOVO.RCS_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DET_PERIOD_END_DTE = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DETAIL_STATUS != 'CANCEL'

	AND LLI IN ('L00', 'LL0')

	AND WW_CDE IN ('12', '14')

	),

	

	COLLECT_ALL(TRANSACTION_ID, TYPE) AS (

	SELECT TRANSACTION_ID, TYPE FROM RESUBMITS

	UNION ALL

	SELECT TRANSACTION_ID, TYPE FROM ISC

	UNION ALL

	SELECT TRANSACTION_ID, TYPE FROM BLUEDESK_SCRAP_RESERVE_PHOENIX

	UNION ALL

	SELECT TRANSACTION_ID, TYPE FROM RCS_INFO

	)

	

	SELECT DISTINCT LTRIM(RTRIM(TRANSACTION_ID)) FROM COLLECT_ALL

	" />

  </report>

  



<report includeHeader="Custom">

    <fileName text="Manual_Approval_Types.csv" />

    <dateFormat text="YYYYMMDD" />

    <timeFormat text="HH:MM:SS" />

    <SQL text="

	WITH PERIOD(PERIOD_END_DTE) AS (

	SELECT MIN(PERIOD_END_DTE) FROM LENOVO.PERIOD_DATES

	WHERE LEN_DATA_REC = 'N'

	),

	

	RESUBMITS(TYPE, TRANSACTION_ID) AS (

	SELECT 

	'BF RESUB' AS TYPE, TRANSACTION_ID

	FROM LENOVO.BF_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DET_PERIOD_END_DTE != (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DETAIL_STATUS != 'CANCEL'

	

	UNION ALL

	

	SELECT 

	'DR RESUB' AS TYPE, TRANSACTION_ID

	FROM LENOVO.DR_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DET_PERIOD_END_DTE != (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DETAIL_STATUS != 'CANCEL'

	

	UNION ALL

	

	SELECT 

	'RCS  RESUB' AS TYPE, TRANSACTION_ID

	FROM LENOVO.RCS_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DET_PERIOD_END_DTE != (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DETAIL_STATUS != 'CANCEL'

	

	UNION ALL

	

	SELECT 

	'PL  RESUB' AS TYPE, TRANSACTION_ID

	FROM LENOVO.PL_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DET_PERIOD_END_DTE != (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DETAIL_STATUS != 'CANCEL'

	),

	

	ISC(TYPE, TRANSACTION_ID, MACH, SERIAL) AS (

	SELECT 

	LLI || ' ISC' AS TYPE,

	TRANSACTION_ID, MACH, SERIAL

	FROM LENOVO.BF_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DET_PERIOD_END_DTE = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DETAIL_STATUS != 'CANCEL'

	AND LLI NOT IN ('L00', 'OTE') AND LLI IS NOT NULL

	

	UNION ALL

	

	SELECT 

	LLI || ' ISC' AS TYPE,

	TRANSACTION_ID, MACH, SERIAL

	FROM LENOVO.DR_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DET_PERIOD_END_DTE = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DETAIL_STATUS != 'CANCEL'

	AND LLI NOT IN ('L00', 'OTE') AND LLI IS NOT NULL

	

	UNION ALL 

	

	SELECT 

	LLI || ' ISC' AS TYPE,

	TRANSACTION_ID, MACH, SERIAL

	FROM LENOVO.RCS_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DET_PERIOD_END_DTE = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DETAIL_STATUS != 'CANCEL'

	AND LLI NOT IN ('L00', 'OTE') AND LLI IS NOT NULL

	

	UNION ALL

	

	SELECT 

	LLI || ' ISC' AS TYPE,

	TRANSACTION_ID, MACH, SERIAL

	FROM LENOVO.PL_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DET_PERIOD_END_DTE = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DETAIL_STATUS != 'CANCEL'

	AND LLI NOT IN ('L00', 'OTE') AND LLI IS NOT NULL

	),

	

	BLUEDESK_SCRAP_RESERVE_PHOENIX(TYPE, TRANSACTION_ID) AS (

	SELECT 

	CASE WHEN CLAIM_NUM = 'BLUEDESK' OR DOCNUM = 'BLUEDESK' OR SERIAL = 'XXXXXXX' THEN 'BLUEDESK' ELSE CASE WHEN WW_CDE = '47' THEN 'RESERVE' ELSE CASE WHEN WW_CDE IN ('48', '49') THEN 'SCRAP' ELSE CASE WHEN DATA_SOURCE IN ('JA', 'KD', 'KE', 'KF', 'LB') THEN 'PHOENIX' END END END END AS TYPE,

	TRANSACTION_ID

	FROM LENOVO.PL_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DET_PERIOD_END_DTE = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DETAIL_STATUS != 'CANCEL'

	AND LLI IN ('L00', 'LL0')

	AND ( DOCNUM = 'BLUEDESK' OR CLAIM_NUM = 'BLUEDESK' OR SERIAL = 'XXXXXXX' OR WW_CDE IN ('47', '48', '49') OR DATA_SOURCE IN ('JA', 'KD', 'KE', 'KF', 'LB') )

	),

	

	RCS_INFO(TYPE, TRANSACTION_ID) AS (

	SELECT 

	'INFO' AS TYPE,

	TRANSACTION_ID

	FROM LENOVO.RCS_ALL_BYWW_V 

	WHERE EFFECTIVE_PERIOD = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DET_PERIOD_END_DTE = (SELECT PERIOD_END_DTE FROM PERIOD)

	AND DETAIL_STATUS != 'CANCEL'

	AND LLI IN ('L00', 'LL0')

	AND WW_CDE IN ('12', '14')

	),

	

	COLLECT_ALL(TRANSACTION_ID, TYPE) AS (

	SELECT TRANSACTION_ID, TYPE FROM RESUBMITS

	UNION ALL

	SELECT TRANSACTION_ID, TYPE FROM ISC

	UNION ALL

	SELECT TRANSACTION_ID, TYPE FROM BLUEDESK_SCRAP_RESERVE_PHOENIX

	UNION ALL

	SELECT TRANSACTION_ID, TYPE FROM RCS_INFO

	)

	

	SELECT DISTINCT LTRIM(RTRIM(TRANSACTION_ID)), TYPE FROM COLLECT_ALL

	" />

  </report>  

</reports>

