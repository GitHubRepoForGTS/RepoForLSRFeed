<?xml version="1.0" encoding="UTF-8"?>

<!--    INVOICE SUMMARY DESCRIPTIVE TEXT.  THIS REPORT GENERATES THE TEXT THAT WILL WILL BE USED TO  -->
<!--    DESCRIBE THE BILLABLE LINE ITEMS FOR THE LENOVO INVOICE  -->

<!-- Modification History                            	 		-->
<!-- 09/12/2008 | VM | First Cut					-->
<!-- 2009-08-17 | VM | C3949 New set of billing tables.  Updated target period to use new LEN_DATA_REC flag -->


<!DOCTYPE reports SYSTEM "./../../dtd/LSRExtract.dtd">

<reports>
 
  <multiReport>
      <fileName text="lenovo_invoice_text.csv" />
      <dateFormat text="MMMM dd yyyy" />
      <timeFormat text="HH:MM:SS" />

      <subReport includeHeader="None" includeTotals="N">
      	<SQL text="
		WITH TARGET_PERIOD(PERIOD_END_DTE) AS (
		SELECT MAX(PERIOD_END_DTE) FROM LENOVO.PERIOD_DATES WHERE LEN_DATA_REC = 'Y'
		),

		CURRENT_WW_RATE(WW_CDE, BILLING_RATE) AS (
		SELECT WW_CDE, BILLING_RATE FROM LENOVO.WW_CODE_REF WHERE (WW_CDE, END_DATE) IN ( 
		SELECT WW_CDE, MAX(END_DATE)  FROM LENOVO.WW_CODE_REF WHERE RATE_LOOKUP = 'Y'GROUP BY WW_CDE)
		),

		CURRENT_WW(WW_CDE) AS (
		SELECT WW_CDE FROM LENOVO.WW_CODE_REF WHERE (WW_CDE, END_DATE) IN ( 
		SELECT WW_CDE, MAX(END_DATE)  FROM LENOVO.WW_CODE_REF WHERE RATE_LOOKUP = 'N'GROUP BY WW_CDE)
		),

		SDW_COMPONENTS_IBM(SDW_COMP_ID) AS (
		SELECT SDW_COMP_ID FROM LENOVO.SDW_COMPONENTS WHERE LENOVO_INT = 'Y'
		),

		RCS_IBM(WW_CDE, BILLING_RATE, TOTAL) AS (
		SELECT WW_CDE, 
		SUM(BILLING_RATE * TRANSACTION_CNT) AS BILLING_RATE,
		VALUE(CAST(SUM(TRANSACTION_CNT) AS INTEGER), 0) AS TOTAL
		FROM LENOVO.RCS_ALL_BYWW_V A
		WHERE EFFECTIVE_PERIOD IN (SELECT PERIOD_END_DTE FROM TARGET_PERIOD) 
		AND DETAIL_STATUS = 'APPROVED'
		AND COUNTRY_CDE = '649'
		AND SDW_COMP_ID NOT IN (SELECT SDW_COMP_ID FROM SDW_COMPONENTS_IBM)
		AND ((WW_CDE, BILLING_RATE) IN (SELECT WW_CDE, BILLING_RATE FROM CURRENT_WW_RATE) OR WW_CDE IN (SELECT WW_CDE FROM CURRENT_WW))
		GROUP BY WW_CDE
		),

		BF_IBM(WW_CDE, BILLING_RATE, TOTAL) AS (
		SELECT WW_CDE, 
		SUM(BILLING_RATE * TRANSACTION_CNT) AS BILLING_RATE,
		VALUE(CAST(SUM(TRANSACTION_CNT) AS INTEGER), 0) AS TOTAL
		FROM LENOVO.BF_ALL_BYWW_V A
		WHERE EFFECTIVE_PERIOD IN (SELECT PERIOD_END_DTE FROM TARGET_PERIOD) 
		AND DETAIL_STATUS = 'APPROVED'
		AND COUNTRY_CDE = '649'
		AND SDW_COMP_ID NOT IN (SELECT SDW_COMP_ID FROM SDW_COMPONENTS_IBM)
		AND ((WW_CDE, BILLING_RATE) IN (SELECT WW_CDE, BILLING_RATE FROM CURRENT_WW_RATE) OR WW_CDE IN (SELECT WW_CDE FROM CURRENT_WW))
		GROUP BY WW_CDE
		),

		DR_IBM(WW_CDE, BILLING_RATE, TOTAL) AS (
		SELECT WW_CDE, 
		SUM(BILLING_RATE * TRANSACTION_CNT) AS BILLING_RATE,
		VALUE(CAST(SUM(TRANSACTION_CNT) AS INTEGER), 0) AS TOTAL
		FROM LENOVO.DR_ALL_BYWW_V A
		WHERE EFFECTIVE_PERIOD IN (SELECT PERIOD_END_DTE FROM TARGET_PERIOD) 
		AND DETAIL_STATUS = 'APPROVED'
		AND COUNTRY_CDE = '649'
		AND SDW_COMP_ID NOT IN (SELECT SDW_COMP_ID FROM SDW_COMPONENTS_IBM)
		AND ((WW_CDE, BILLING_RATE) IN (SELECT WW_CDE, BILLING_RATE FROM CURRENT_WW_RATE) OR WW_CDE IN (SELECT WW_CDE FROM CURRENT_WW))
		GROUP BY WW_CDE
		),

		PL_ALL_IBM (WW_CDE, BILLING_RATE, TOTAL, PART_COST) AS (
		SELECT WW_CDE, 
		SUM(BILLING_RATE * TRANSACTION_CNT) AS BILLING_RATE,
		VALUE(CAST(SUM(TRANSACTION_CNT) AS INTEGER), 0) AS TOTAL,
		SUM(PART_COST)
		FROM LENOVO.PL_ALL_BYWW_V A
		WHERE EFFECTIVE_PERIOD IN (SELECT PERIOD_END_DTE FROM TARGET_PERIOD) 
		AND DETAIL_STATUS = 'APPROVED'
		AND COUNTRY_CDE = '649'
		AND SDW_COMP_ID NOT IN (SELECT SDW_COMP_ID FROM SDW_COMPONENTS_IBM)
		AND WW_CDE NOT IN ('99')
		AND ((WW_CDE, BILLING_RATE) IN (SELECT WW_CDE, BILLING_RATE FROM CURRENT_WW_RATE) OR WW_CDE IN (SELECT WW_CDE FROM CURRENT_WW))
		GROUP BY WW_CDE
		),

		PL_ALL_IBM_99(WW_CDE, SDW_COMP_ID, TOTAL, PART_COST) AS (
		SELECT WW_CDE, 
		SDW_COMP_ID,
		VALUE(CAST(SUM(TRANSACTION_CNT) AS INTEGER), 0) AS TOTAL,
		SUM(PART_COST) AS BILLING_RATE
		FROM LENOVO.PL_ALL_BYWW_V A
		WHERE EFFECTIVE_PERIOD IN (SELECT PERIOD_END_DTE FROM TARGET_PERIOD) 
		AND DETAIL_STATUS = 'APPROVED'
		AND COUNTRY_CDE = '649'
		AND SDW_COMP_ID NOT IN (SELECT SDW_COMP_ID FROM SDW_COMPONENTS_IBM)
		AND WW_CDE = '99'
		GROUP BY WW_CDE, SDW_COMP_ID
		),

		PL_ALL_BYSDW_IBM (SDW_COMP_ID, CDN_SDW_COMP_DESC, PART_COST)  AS (
		SELECT B.SDW_COMP_ID,
		B.CDN_SDW_COMP_DESC,
		CAST (SUM(A.PART_COST) AS DECIMAL(15,7))
		FROM PL_ALL_IBM A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'N' = B.LENOVO_INT
		GROUP BY B.SDW_COMP_ID, B.CDN_SDW_COMP_DESC
		),

		PARTS_CREDIT_IBM(SDW_COMP_ID, PARTS_CREDIT) AS (
		SELECT 'C0001296' AS SDW_COMP_ID, CAST(VALUE(SUM(PART_CREDIT),0)AS DECIMAL(15,7)) AS PARTS_CREDIT 
		FROM LENOVO.PL_ALL_BYWW_V 
		WHERE EFFECTIVE_PERIOD IN (SELECT PERIOD_END_DTE FROM TARGET_PERIOD) 
		AND DETAIL_STATUS = 'APPROVED' AND WW_CDE = '61' AND SDW_COMP_ID NOT IN (SELECT SDW_COMP_ID FROM SDW_COMPONENTS_IBM)
		AND COUNTRY_CDE = '649'
		),

		PARTS_MANAGEMENT_FEE(SDW_COMP_ID, PARTS_FEE) AS (
		SELECT 
		'C0001305' AS SDW_COMP_ID, 
		ROUND(PART_MANAGE_FEE, 2)
		FROM LENOVO.APPR_FEE15 WHERE PERIOD_END_DTE IN (SELECT PERIOD_END_DTE FROM TARGET_PERIOD) 
		AND COUNTRY_CDE = '649'
		),

		SDW_COMPONENTS_LEN(SDW_COMP_ID) AS (
		SELECT SDW_COMP_ID FROM LENOVO.SDW_COMPONENTS WHERE LENOVO_INT = 'N'
		),

		RCS_LEN(WW_CDE, BILLING_RATE, TOTAL) AS (
		SELECT WW_CDE, 
		SUM(BILLING_RATE * TRANSACTION_CNT) AS BILLING_RATE,
		VALUE(CAST(SUM(TRANSACTION_CNT) AS INTEGER), 0) AS TOTAL
		FROM LENOVO.RCS_ALL_BYWW_V A
		WHERE EFFECTIVE_PERIOD IN (SELECT PERIOD_END_DTE FROM TARGET_PERIOD) 
		AND DETAIL_STATUS = 'APPROVED'
		AND COUNTRY_CDE = '649'
		AND SDW_COMP_ID NOT IN (SELECT SDW_COMP_ID FROM SDW_COMPONENTS_LEN)
		AND ((WW_CDE, BILLING_RATE) IN (SELECT WW_CDE, BILLING_RATE FROM CURRENT_WW_RATE) OR WW_CDE IN (SELECT WW_CDE FROM CURRENT_WW))
		GROUP BY WW_CDE
		),

		BF_LEN(WW_CDE, BILLING_RATE, TOTAL) AS (
		SELECT WW_CDE, 
		SUM(BILLING_RATE * TRANSACTION_CNT) AS BILLING_RATE,
		VALUE(CAST(SUM(TRANSACTION_CNT) AS INTEGER), 0) AS TOTAL
		FROM LENOVO.BF_ALL_BYWW_V A
		WHERE EFFECTIVE_PERIOD IN (SELECT PERIOD_END_DTE FROM TARGET_PERIOD) 
		AND DETAIL_STATUS = 'APPROVED'
		AND COUNTRY_CDE = '649'
		AND SDW_COMP_ID NOT IN (SELECT SDW_COMP_ID FROM SDW_COMPONENTS_LEN)
		AND ((WW_CDE, BILLING_RATE) IN (SELECT WW_CDE, BILLING_RATE FROM CURRENT_WW_RATE) OR WW_CDE IN (SELECT WW_CDE FROM CURRENT_WW))
		GROUP BY WW_CDE
		),

		DR_LEN(WW_CDE, BILLING_RATE, TOTAL) AS (
		SELECT WW_CDE, 
		SUM(BILLING_RATE * TRANSACTION_CNT) AS BILLING_RATE,
		VALUE(CAST(SUM(TRANSACTION_CNT) AS INTEGER), 0) AS TOTAL
		FROM LENOVO.DR_ALL_BYWW_V A
		WHERE EFFECTIVE_PERIOD IN (SELECT PERIOD_END_DTE FROM TARGET_PERIOD) 
		AND DETAIL_STATUS = 'APPROVED'
		AND COUNTRY_CDE = '649'
		AND SDW_COMP_ID NOT IN (SELECT SDW_COMP_ID FROM SDW_COMPONENTS_LEN)
		AND ((WW_CDE, BILLING_RATE) IN (SELECT WW_CDE, BILLING_RATE FROM CURRENT_WW_RATE) OR WW_CDE IN (SELECT WW_CDE FROM CURRENT_WW))
		GROUP BY WW_CDE
		),

		PL_ALL_LEN (WW_CDE, BILLING_RATE, TOTAL, PART_COST) AS (
		SELECT WW_CDE, 
		SUM(BILLING_RATE * TRANSACTION_CNT) AS BILLING_RATE,
		VALUE(CAST(SUM(TRANSACTION_CNT) AS INTEGER), 0) AS TOTAL,
		SUM(PART_COST)
		FROM LENOVO.PL_ALL_BYWW_V A
		WHERE EFFECTIVE_PERIOD IN (SELECT PERIOD_END_DTE FROM TARGET_PERIOD) 
		AND DETAIL_STATUS = 'APPROVED'
		AND COUNTRY_CDE = '649'
		AND SDW_COMP_ID NOT IN (SELECT SDW_COMP_ID FROM SDW_COMPONENTS_LEN)
		AND ((WW_CDE, BILLING_RATE) IN (SELECT WW_CDE, BILLING_RATE FROM CURRENT_WW_RATE) OR WW_CDE IN (SELECT WW_CDE FROM CURRENT_WW))
		GROUP BY WW_CDE
		),

		PL_ALL_BYSDW_LEN (SDW_COMP_ID, CDN_SDW_COMP_DESC, PART_COST)  AS (
		SELECT B.SDW_COMP_ID,
		B.CDN_SDW_COMP_DESC,
		CAST (SUM(A.PART_COST) AS DECIMAL(15,7))
		FROM PL_ALL_LEN A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'Y' = B.LENOVO_INT
		GROUP BY B.SDW_COMP_ID, B.CDN_SDW_COMP_DESC
		),

		PARTS_CREDIT_LEN(SDW_COMP_ID, PARTS_CREDIT) AS (
		SELECT 'C0001371' AS SDW_COMP_ID, CAST(VALUE(SUM(PART_CREDIT),0)AS DECIMAL(15,7)) AS PARTS_CREDIT 
		FROM LENOVO.PL_ALL_BYWW_V 
		WHERE EFFECTIVE_PERIOD IN (SELECT PERIOD_END_DTE FROM TARGET_PERIOD) 
		AND DETAIL_STATUS = 'APPROVED' AND WW_CDE = '61' AND SDW_COMP_ID NOT IN (SELECT SDW_COMP_ID FROM SDW_COMPONENTS_LEN)
		AND COUNTRY_CDE = '649'
		),

		SUB1(SUBPOS, DESC) AS (
		VALUES (1, 'Customer Number:  00788968    Using Bill Number 02 for Maintenance'),
		(2, 'Contract Number:  P0078528'),
		(3, 'Customer Reference:  James Van Leeuwen'),
		(4, 'BILLING PERIOD:  ' || (SELECT MONTHNAME(PERIOD_START_DTE) || ' ' || CAST(DAY(PERIOD_START_DTE) AS CHAR(2)) || ', ' || CAST(YEAR(PERIOD_START_DTE) AS CHAR(4)) || '    TO    ' || MONTHNAME(PERIOD_END_DTE) || ' ' || CAST(DAY(PERIOD_END_DTE) AS CHAR(2)) || ', ' || CAST(YEAR(PERIOD_END_DTE) AS CHAR(4))FROM LENOVO.PERIOD_DATES WHERE PERIOD_END_DTE = (SELECT MAX(PERIOD_END_DTE) FROM LENOVO.PERIOD_DATES WHERE LEN_DATA_REC = 'Y' ))),
		(5, ' '),
		(6, 'Lenovo External Customer - PST Exemption Certificate 1670-7966 (ON)')
		),

		SUB2(SUBPOS, DESC) AS (
		VALUES (1, '.'),
		(2, 'DESCRIPTION:  REMOTE CUSTOMER SUPPORT'),
		(3, '.'),
		(4, 'REMOTE CUSTOMER SUPPORT              # OF LAUNCHES   RATE  AMOUNT DUE'),
		(5, '---------------------------------------------------------------------')
		),

		SUB3(SUBPOS, DESC) AS (
		SELECT
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ') || '  ' || LENOVO.LPAD(RTRIM(CHAR(SUM(A.TOTAL))), 5, ' ') || ' ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(C.BILLING_RATE), '0'), 9, ' ') || ' ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(SUM(A.BILLING_RATE)), '0'), 11, ' ')  AS DESC
		FROM RCS_IBM A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'N' = B.LENOVO_INT 
		LEFT JOIN CURRENT_WW_RATE C ON A.WW_CDE = C.WW_CDE
		GROUP BY B.SDW_COMP_ID, C.BILLING_RATE,B.CDN_SDW_COMP_DESC ORDER BY B.SDW_COMP_ID
		),

		SUB4(SUBPOS, DESC) AS (
		VALUES (1, '.'),
		(2, 'DESCRIPTION: ON-SITE BREAK FIX SERVICE'),
		(3, '.'),
		(4, 'ON-SITE BREAK FIX SERVICE            # OF LAUNCHES   RATE  AMOUNT DUE'),
		(5, '---------------------------------------------------------------------')
		),

		SUB5(SUBPOS, DESC) AS (
		SELECT
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ') || '  ' || LENOVO.LPAD(RTRIM(CHAR(SUM(A.TOTAL))), 5, ' ') || ' ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(C.BILLING_RATE), '0'), 9, ' ') || ' ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(SUM(A.BILLING_RATE)), '0'), 11, ' ')  AS DESC
		FROM BF_IBM A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'N' = B.LENOVO_INT 
		LEFT JOIN CURRENT_WW_RATE C ON A.WW_CDE = C.WW_CDE
		GROUP BY B.SDW_COMP_ID, C.BILLING_RATE,B.CDN_SDW_COMP_DESC ORDER BY B.SDW_COMP_ID
		),

		SUB6(SUBPOS, DESC) AS (
		VALUES (1, '.'),
		(2, 'DESCRIPTION: PARTS LOGISTICS AND MANAGEMENT SERVICES'),
		(3, '.'),
		(4, 'PARTS LOGISTICS AND MANAGEMENT       # OF LAUNCHES   RATE  AMOUNT DUE'),
		(5, '---------------------------------------------------------------------')
		),


		SUB7(SDW_COMP_ID, SUBPOS, DESC) AS (
		SELECT
		B.SDW_COMP_ID,
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ') || '  ' || LENOVO.LPAD(RTRIM(CHAR(SUM(A.TOTAL))), 5, ' ') || ' ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(C.BILLING_RATE), '0'), 9, ' ') || ' ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(SUM(A.BILLING_RATE)), '0'), 11, ' ')  AS DESC
		FROM PL_ALL_IBM A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'N' = B.LENOVO_INT 
		LEFT JOIN CURRENT_WW_RATE C ON A.WW_CDE = C.WW_CDE
		WHERE SDW_COMP_ID IN ('C0001284', 'C0001285', 'C0001287')
		GROUP BY B.SDW_COMP_ID, C.BILLING_RATE,B.CDN_SDW_COMP_DESC

		UNION ALL

		SELECT
		B.SDW_COMP_ID,
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ') || '  ' || LENOVO.LPAD(RTRIM(CHAR(SUM(A.TOTAL))), 5, ' ') || ' ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(CAST(ROUND(A.PART_COST / SUM(A.TOTAL), 2)as decimal(15,2))), '0'), 9, ' ') || ' ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(CAST(ROUND(SUM(A.PART_COST), 2)as decimal(15,2))), '0'), 11, ' ')  AS DESC
		FROM PL_ALL_IBM_99 A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.SDW_COMP_ID = B.SDW_COMP_ID AND 'N' = B.LENOVO_INT 
		GROUP BY B.SDW_COMP_ID, A.PART_COST,B.CDN_SDW_COMP_DESC 

		ORDER BY SDW_COMP_ID
		),

		SUB8 (SUBPOS, DESC)  AS (
		SELECT 
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ')  || '                  ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(cast(ROUND(SUM(A.PART_COST), 2) as decimal(15,2))), '0'), 11, ' ')  AS DESC
		FROM PL_ALL_IBM A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'N' = B.LENOVO_INT
		WHERE B.SDW_COMP_ID NOT IN ('C0001296', 'C0001297', 'C0001284', 'C0001285', 'C0001287', 'C0001299')
		GROUP BY B.SDW_COMP_ID, B.CDN_SDW_COMP_DESC ORDER BY B.SDW_COMP_ID
		),

		SUB9 (SUBPOS, DESC) AS (
		SELECT
		1,
		CASE WHEN A.SDW_COMP_ID = 'C0001296' THEN LENOVO.RPAD(CAST(A.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ')  || '                  ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(CAST(ROUND(A.PART_COST - C.PARTS_CREDIT, 2) AS DECIMAL(15, 2))), '0'), 11, ' ') ELSE LENOVO.RPAD(CAST(A.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ')  || '                  ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(CAST(ROUND(A.PART_COST, 2) AS DECIMAL(15,2))), '0'), 11, ' ') END AS DESC
		FROM PL_ALL_BYSDW_IBM A LEFT JOIN PARTS_CREDIT_IBM C ON A.SDW_COMP_ID = C.SDW_COMP_ID 
		WHERE A.SDW_COMP_ID IN ('C0001296')
		),

		SUB10(SUBPOS, DESC) AS (
		SELECT 1, CASE WHEN PARTS_CREDIT &gt; 0 THEN '(Parts cost include parts warranty redemption credit of ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(CAST(ROUND(PARTS_CREDIT, 2) AS DECIMAL(15,2))), '0'), 11, ' ') || ')' ELSE '' END FROM PARTS_CREDIT_IBM 
		),

		SUB11 (SUBPOS, DESC) AS (
		SELECT
		1, 
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ')  || '                  ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(CAST(ROUND(A.PARTS_FEE, 2) AS DECIMAL(15,2))), '0'), 11, ' ')  AS DESC
		FROM PARTS_MANAGEMENT_FEE A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.SDW_COMP_ID = B.SDW_COMP_ID
		),

		SUB12(SUBPOS, DESC) AS (
		VALUES (1, '.'),
		(2, 'DESCRIPTION: DEPOT REPAIR FEES'),
		(3, '.'),
		(4, 'DEPOT REPAIR FEES                    # OF LAUNCHES   RATE  AMOUNT DUE'),
		(5, '---------------------------------------------------------------------')
		),

		SUB13(SUBPOS, DESC) AS (
		SELECT
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ') || '  ' || LENOVO.LPAD(RTRIM(CHAR(SUM(A.TOTAL))), 5, ' ') || ' ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(C.BILLING_RATE), '0'), 9, ' ') || ' ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(SUM(A.BILLING_RATE)), '0'), 11, ' ')  AS DESC
		FROM DR_IBM A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'N' = B.LENOVO_INT 
		LEFT JOIN CURRENT_WW_RATE C ON A.WW_CDE = C.WW_CDE
		GROUP BY B.SDW_COMP_ID, C.BILLING_RATE,B.CDN_SDW_COMP_DESC ORDER BY B.SDW_COMP_ID
		),

		SUB14(SUBPOS, DESC) AS (
		SELECT 
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ')  || '                  ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(cast(ROUND(SUM(A.PART_COST), 2) as decimal(15,2))), '0'), 11, ' ')  AS DESC
		FROM PL_ALL_IBM A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'N' = B.LENOVO_INT
		WHERE B.SDW_COMP_ID IN ('C0001299')
		GROUP BY B.SDW_COMP_ID, B.CDN_SDW_COMP_DESC
		),

		SUB15(SUBPOS, DESC) AS (
		VALUES (1, '.'),
		(2, 'Lenovo Internal Employee (Taxable)')
		),

		SUB16(SUBPOS, DESC) AS (
		VALUES (1, '.'),
		(2, 'DESCRIPTION:  REMOTE CUSTOMER SUPPORT'),
		(3, '.'),
		(4, 'REMOTE CUSTOMER SUPPORT              # OF LAUNCHES   RATE  AMOUNT DUE'),
		(5, '---------------------------------------------------------------------')
		),

		SUB17(SUBPOS, DESC) AS (
		SELECT
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ') || '  ' || LENOVO.LPAD(RTRIM(CHAR(SUM(A.TOTAL))), 5, ' ') || ' ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(C.BILLING_RATE), '0'), 9, ' ') || ' ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(SUM(A.BILLING_RATE)), '0'), 11, ' ')  AS DESC
		FROM RCS_LEN A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'Y' = B.LENOVO_INT 
		LEFT JOIN CURRENT_WW_RATE C ON A.WW_CDE = C.WW_CDE
		GROUP BY B.SDW_COMP_ID, C.BILLING_RATE,B.CDN_SDW_COMP_DESC ORDER BY B.SDW_COMP_ID
		),

		SUB18(SUBPOS, DESC) AS (
		VALUES (1, '.'),
		(2, 'DESCRIPTION: ON-SITE BREAK FIX SERVICE'),
		(3, '.'),
		(4, 'ON-SITE BREAK FIX SERVICE            # OF LAUNCHES   RATE  AMOUNT DUE'),
		(5, '---------------------------------------------------------------------')
		),

		SUB19(SUBPOS, DESC) AS (
		SELECT
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ') || '  ' || LENOVO.LPAD(RTRIM(CHAR(SUM(A.TOTAL))), 5, ' ') || ' ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(C.BILLING_RATE), '0'), 9, ' ') || ' ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(SUM(A.BILLING_RATE)), '0'), 11, ' ')  AS DESC
		FROM BF_LEN A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'Y' = B.LENOVO_INT 
		LEFT JOIN CURRENT_WW_RATE C ON A.WW_CDE = C.WW_CDE
		GROUP BY B.SDW_COMP_ID, C.BILLING_RATE,B.CDN_SDW_COMP_DESC ORDER BY B.SDW_COMP_ID
		),

		SUB20(SUBPOS, DESC) AS (
		VALUES (1, '.'),
		(2, 'DESCRIPTION: PARTS LOGISTICS AND MANAGEMENT SERVICES'),
		(3, '.'),
		(4, 'PARTS LOGISTICS AND MANAGEMENT       # OF LAUNCHES   RATE  AMOUNT DUE'),
		(5, '---------------------------------------------------------------------')
		),

		SUB21(SUBPOS, DESC) AS (
		SELECT
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ') || '  ' || LENOVO.LPAD(RTRIM(CHAR(SUM(A.TOTAL))), 5, ' ') || ' ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(C.BILLING_RATE), '0'), 9, ' ') || ' ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(SUM(A.BILLING_RATE)), '0'), 11, ' ')  AS DESC
		FROM PL_ALL_LEN A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'Y' = B.LENOVO_INT 
		LEFT JOIN CURRENT_WW_RATE C ON A.WW_CDE = C.WW_CDE
		WHERE SDW_COMP_ID IN ('C0001359', 'C0001360', 'C0001362')
		GROUP BY B.SDW_COMP_ID, C.BILLING_RATE,B.CDN_SDW_COMP_DESC ORDER BY B.SDW_COMP_ID
		),

		SUB22 (SUBPOS, DESC)  AS (
		SELECT 
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ')  || '                  ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(cast(ROUND(SUM(A.PART_COST), 2) as decimal(15,2))), '0'), 11, ' ')  AS DESC
		FROM PL_ALL_LEN A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'Y' = B.LENOVO_INT
		WHERE B.SDW_COMP_ID NOT IN ('C0001371', 'C0001372','C0001359', 'C0001360', 'C0001362', 'C0001373')
		GROUP BY B.SDW_COMP_ID, B.CDN_SDW_COMP_DESC ORDER BY B.SDW_COMP_ID
		),

		SUB23 (SUBPOS, DESC) AS (
		SELECT 
		1,
		CASE WHEN A.SDW_COMP_ID = 'C0001371' THEN LENOVO.RPAD(CAST(A.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ')  || '                  ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(CAST(ROUND(A.PART_COST - C.PARTS_CREDIT, 2) AS DECIMAL(15, 2))), '0'), 11, ' ') ELSE LENOVO.RPAD(CAST(A.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ')  || '                  ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(CAST(ROUND(A.PART_COST, 2) AS DECIMAL(15,2))), '0'), 11, ' ') END AS DESC
		FROM PL_ALL_BYSDW_LEN A LEFT JOIN PARTS_CREDIT_LEN C ON A.SDW_COMP_ID = C.SDW_COMP_ID 
		WHERE A.SDW_COMP_ID IN ('C0001371')
		),

		SUB24(SUBPOS,  DESC) AS (
		SELECT 1, CASE WHEN PARTS_CREDIT &gt; 0 THEN '(Parts cost include parts warranty redemption credit of ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(CAST(ROUND(PARTS_CREDIT, 2) AS DECIMAL(15,2))), '0'), 11, ' ') || ')' ELSE '' END FROM PARTS_CREDIT_LEN
		),

		SUB25(SUBPOS, DESC) AS (
		VALUES (1, '.'),
		(2, 'DESCRIPTION: DEPOT REPAIR FEES'),
		(3, '.'),
		(4, 'DEPOT REPAIR FEES                    # OF LAUNCHES   RATE  AMOUNT DUE'),
		(5, '---------------------------------------------------------------------')
		),

		SUB26(SUBPOS, DESC) AS (
		SELECT
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ') || '  ' || LENOVO.LPAD(RTRIM(CHAR(SUM(A.TOTAL))), 5, ' ') || ' ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(C.BILLING_RATE), '0'), 9, ' ') || ' ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(SUM(A.BILLING_RATE)), '0'), 11, ' ')  AS DESC
		FROM DR_LEN A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'Y' = B.LENOVO_INT 
		LEFT JOIN CURRENT_WW_RATE C ON A.WW_CDE = C.WW_CDE
		GROUP BY B.SDW_COMP_ID, C.BILLING_RATE,B.CDN_SDW_COMP_DESC ORDER BY B.SDW_COMP_ID
		),

		SUB27(SUBPOS, DESC) AS (
		SELECT 
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ')  || '                  ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(cast(ROUND(SUM(A.PART_COST), 2) as decimal(15,2))), '0'), 11, ' ')  AS DESC
		FROM PL_ALL_LEN A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'Y' = B.LENOVO_INT
		WHERE B.SDW_COMP_ID IN ('C0001373')
		GROUP BY B.SDW_COMP_ID, B.CDN_SDW_COMP_DESC
		),

		OUTPUT_ALL(POS, SUBPOS, HEADER, DESC) AS (
		SELECT 1 AS POS, SUBPOS, 1, CAST(DESC AS CHAR(69)) FROM SUB1 UNION ALL 
		SELECT 2 AS POS, SUBPOS, 0, CAST(DESC AS CHAR(69)) FROM SUB2 UNION ALL
		SELECT 3 AS POS, SUBPOS, 2,CAST(DESC AS CHAR(69)) FROM SUB3 UNION ALL
		SELECT 4 AS POS, SUBPOS, 0, CAST(DESC AS CHAR(69)) FROM SUB4 UNION ALL
		SELECT 5 AS POS, SUBPOS, 4, CAST(DESC AS CHAR(69)) FROM SUB5 UNION ALL
		SELECT 6 AS POS, SUBPOS, 0, CAST(DESC AS CHAR(69)) FROM SUB6 UNION ALL
		SELECT 7 AS POS, SUBPOS, 6, CAST(DESC AS CHAR(69)) FROM SUB7 UNION ALL
		SELECT 8 AS POS, SUBPOS, 6, CAST(DESC AS CHAR(69)) FROM SUB8 UNION ALL
		SELECT 9 AS POS, SUBPOS, 6, CAST(DESC AS CHAR(69)) FROM SUB9 UNION ALL
		SELECT 10 AS POS, SUBPOS, 6, CAST(DESC AS CHAR(69)) FROM SUB10 WHERE CAST (DESC AS CHAR(69)) NOT IN('') UNION ALL
		SELECT 11 AS POS, SUBPOS, 6, CAST(DESC AS CHAR(69)) FROM SUB11 UNION ALL
		SELECT 12 AS POS, SUBPOS, 0, CAST(DESC AS CHAR(69)) FROM SUB12 UNION ALL
		SELECT 13 AS POS, SUBPOS, 12, CAST(DESC AS CHAR(69)) FROM SUB13 UNION ALL
		SELECT 14 AS POS, SUBPOS, 12, CAST(DESC AS CHAR(69)) FROM SUB14 UNION ALL
		SELECT 15 AS POS, SUBPOS, -1, CAST(DESC AS CHAR(69)) FROM SUB15 UNION ALL
		SELECT 16 AS POS, SUBPOS, 0, CAST(DESC AS CHAR(69)) FROM SUB16 UNION ALL
		SELECT 17 AS POS, SUBPOS, 16, CAST(DESC AS CHAR(69)) FROM SUB17 UNION ALL
		SELECT 18 AS POS, SUBPOS, 0, CAST(DESC AS CHAR(69)) FROM SUB18 UNION ALL
		SELECT 19 AS POS, SUBPOS, 18, CAST(DESC AS CHAR(69)) FROM SUB19 UNION ALL
		SELECT 20 AS POS, SUBPOS, 0, CAST(DESC AS CHAR(69)) FROM SUB20 UNION ALL
		SELECT 21 AS POS, SUBPOS, 20, CAST(DESC AS CHAR(69)) FROM SUB21 UNION ALL
		SELECT 22 AS POS, SUBPOS, 20, CAST(DESC AS CHAR(69)) FROM SUB22 UNION ALL
		SELECT 23 AS POS, SUBPOS, 20, CAST(DESC AS CHAR(69)) FROM SUB23 UNION ALL
		SELECT 24 AS POS, SUBPOS, 20, CAST(DESC AS CHAR(69)) FROM SUB24 WHERE CAST (DESC AS CHAR(69)) NOT IN('') UNION ALL
		SELECT 25 AS POS, SUBPOS, 0, CAST(DESC AS CHAR(69)) FROM SUB25 UNION ALL
		SELECT 26 AS POS, SUBPOS, 25, CAST(DESC AS CHAR(69)) FROM SUB26  UNION ALL
		SELECT 27 AS POS, SUBPOS, 25, CAST(DESC AS CHAR(69)) FROM SUB27
		),

		DISPLAY_HEADERS(DIS_HEADER) AS (
		SELECT DISTINCT HEADER FROM OUTPUT_ALL
		)

		SELECT CASE WHEN A.POS &gt; 1 THEN UCASE(A.DESC) ELSE A.DESC END 
		FROM OUTPUT_ALL A LEFT JOIN DISPLAY_HEADERS B ON A.POS = B.DIS_HEADER
		WHERE A.HEADER &gt; 0 OR B.DIS_HEADER &gt; 0 OR 
		(A.HEADER = -1 AND ((SELECT COUNT(*) FROM DISPLAY_HEADERS WHERE DIS_HEADER &gt; 14)  &gt; 0))
		ORDER BY A.POS, A.SUBPOS
		
      "/>
      </subReport>
            
  </multiReport>    

</reports>
