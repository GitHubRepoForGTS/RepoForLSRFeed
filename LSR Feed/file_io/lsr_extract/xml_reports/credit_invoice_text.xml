<?xml version="1.0" encoding="UTF-8"?>

<!--    CREDIT INVOICE SUMMARY DESCRIPTIVE TEXT.  THIS REPORT GENERATES THE TEXT THAT WILL WILL BE USED TO  -->
<!--    DESCRIBE THE BILLABLE LINE ITEMS FOR THE LENOVO CREDIT INVOICE  -->

<!-- Modification History                            	 		-->
<!-- 09/12/2008 | VM | First Cut					-->
<!-- 2009-05-01 | VM | Added capability to account for a Parts Management Feed Credit.   remove '003' to undo this -->
<!-- 2009-08-17 | VM | C3949 New set of billing tables.  Updated target period to use new LEN_DATA_REC flag -->
<!-- 2009-12-07 | VM | Added 001 code for transaction reversals -->
<!-- 2009-12-11 | VM | Updated Description to Bill number 03 -->
<!-- 2009-12-23 | VM | Updated both parts areas to group the non transactional and transactional items together respectively-->
<!-- 2010-01-06 | VM | Updated contact name to Tony Pasquale -->
<!-- 2010-08-13 | VM | Changed the output file name to include GST-->
<!-- 2010-09-20 | VM | This report modifed to pull HST taxable services only -->
<!-- 2010-09-20 | VM | Added credit code 004 -->
<!-- 2010-11-16 | VM | Removed service date check for GST HST split-->
<!-- 2010-12-10 | VM | Joyce Invoice Change Request:  Remove PST exemption-->

<!DOCTYPE reports SYSTEM "./../../dtd/LSRExtract.dtd">

<reports>
 
  <multiReport>
      <fileName text="lenovo_credit_invoice_text.csv" />
      <dateFormat text="MMMM dd yyyy" />
      <timeFormat text="HH:MM:SS" />

      <subReport includeHeader="None" includeTotals="N">
      	<SQL text="
	
		WITH TARGET_PERIOD(PERIOD_END_DTE) AS (
		SELECT MAX(PERIOD_END_DTE) FROM LENOVO.PERIOD_DATES WHERE LEN_DATA_REC = 'Y'
		),

		WW_CODE_REF(WW_CDE, US_BILL_GRP, RATE_LOOKUP) AS (
		SELECT DISTINCT WW_CDE, US_BILL_GRP, RATE_LOOKUP FROM LENOVO.WW_CODE_REF
		),

		SDW_COMPONENTS_IBM(SDW_COMP_ID) AS (
		SELECT SDW_COMP_ID FROM LENOVO.SDW_COMPONENTS WHERE LENOVO_INT = 'Y'
		),

		RCS_IBM(WW_CDE, BILLING_RATE, TOTAL) AS (
		SELECT WW_CDE, 
		SUM(BILLING_RATE * TRANSACTION_CNT) AS BILLING_RATE,
		VALUE(CAST(SUM(TRANSACTION_CNT) AS INTEGER), 0) AS TOTAL
		FROM LENOVO.RCS_DETAIL_CR
		WHERE PERIOD_END_DTE IN (SELECT PERIOD_END_DTE FROM TARGET_PERIOD) 
		AND STATUS = 'CREDIT'
		AND COUNTRY_CDE = '649'
		AND CREDIT_CDE IN ('001', '002', '004')
		AND SDW_COMP_ID NOT IN (SELECT SDW_COMP_ID FROM SDW_COMPONENTS_IBM)
		GROUP BY WW_CDE
		),

		BF_IBM(WW_CDE, BILLING_RATE, TOTAL) AS (
		SELECT WW_CDE, 
		SUM(BILLING_RATE * TRANSACTION_CNT) AS BILLING_RATE,
		VALUE(CAST(SUM(TRANSACTION_CNT) AS INTEGER), 0) AS TOTAL
		FROM LENOVO.BF_DETAIL_CR
		WHERE PERIOD_END_DTE IN (SELECT PERIOD_END_DTE FROM TARGET_PERIOD) 
		AND STATUS = 'CREDIT'
		AND COUNTRY_CDE = '649'
		AND CREDIT_CDE IN ('001', '002', '004')
		AND SDW_COMP_ID NOT IN (SELECT SDW_COMP_ID FROM SDW_COMPONENTS_IBM)
		GROUP BY WW_CDE
		),

		DR_IBM(WW_CDE, BILLING_RATE, TOTAL) AS (
		SELECT WW_CDE, 
		SUM(BILLING_RATE * TRANSACTION_CNT) AS BILLING_RATE,
		VALUE(CAST(SUM(TRANSACTION_CNT) AS INTEGER), 0) AS TOTAL
		FROM LENOVO.DR_DETAIL_CR
		WHERE PERIOD_END_DTE IN (SELECT PERIOD_END_DTE FROM TARGET_PERIOD) 
		AND STATUS = 'CREDIT'
		AND COUNTRY_CDE = '649'
		AND CREDIT_CDE IN ('001', '002', '004')
		AND SDW_COMP_ID NOT IN (SELECT SDW_COMP_ID FROM SDW_COMPONENTS_IBM)
		GROUP BY WW_CDE
		),

		PL_ALL_IBM (WW_CDE, BILLING_RATE, TOTAL, PART_COST) AS (
		SELECT WW_CDE, 
		SUM(BILLING_RATE * TRANSACTION_CNT) AS BILLING_RATE,
		VALUE(CAST(SUM(TRANSACTION_CNT) AS INTEGER), 0) AS TOTAL,
		SUM(PART_COST)
		FROM LENOVO.PL_DETAIL_CR
		WHERE PERIOD_END_DTE IN (SELECT PERIOD_END_DTE FROM TARGET_PERIOD) 
		AND STATUS = 'CREDIT'
		AND COUNTRY_CDE = '649'
		AND CREDIT_CDE IN ('001', '002', '004', '003')
		AND SDW_COMP_ID NOT IN (SELECT SDW_COMP_ID FROM SDW_COMPONENTS_IBM)
		GROUP BY WW_CDE
		),

		PL_ALL_BYSDW_IBM (SDW_COMP_ID, CDN_SDW_COMP_DESC, PART_COST)  AS (
		SELECT B.SDW_COMP_ID,
		B.CDN_SDW_COMP_DESC,
		CAST (SUM(A.PART_COST) AS DECIMAL(15,7))
		FROM PL_ALL_IBM A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'N' = B.LENOVO_INT
		LEFT JOIN WW_CODE_REF C ON A.WW_CDE = C.WW_CDE
		GROUP BY B.SDW_COMP_ID, C.US_BILL_GRP, B.CDN_SDW_COMP_DESC
		),

		SDW_COMPONENTS_LEN(SDW_COMP_ID) AS (
		SELECT SDW_COMP_ID FROM LENOVO.SDW_COMPONENTS WHERE LENOVO_INT = 'N'
		),

		RCS_LEN(WW_CDE, BILLING_RATE, TOTAL) AS (
		SELECT WW_CDE, 
		SUM(BILLING_RATE * TRANSACTION_CNT) AS BILLING_RATE,
		VALUE(CAST(SUM(TRANSACTION_CNT) AS INTEGER), 0) AS TOTAL
		FROM LENOVO.RCS_DETAIL_CR
		WHERE PERIOD_END_DTE IN (SELECT PERIOD_END_DTE FROM TARGET_PERIOD) 
		AND STATUS = 'CREDIT'
		AND COUNTRY_CDE = '649'
		AND CREDIT_CDE IN ('001', '002', '004')
		AND SDW_COMP_ID NOT IN (SELECT SDW_COMP_ID FROM SDW_COMPONENTS_LEN)
		GROUP BY WW_CDE
		),

		BF_LEN(WW_CDE, BILLING_RATE, TOTAL) AS (
		SELECT WW_CDE, 
		SUM(BILLING_RATE * TRANSACTION_CNT) AS BILLING_RATE,
		VALUE(CAST(SUM(TRANSACTION_CNT) AS INTEGER), 0) AS TOTAL
		FROM LENOVO.BF_DETAIL_CR
		WHERE PERIOD_END_DTE IN (SELECT PERIOD_END_DTE FROM TARGET_PERIOD) 
		AND STATUS = 'CREDIT'
		AND COUNTRY_CDE = '649'
		AND CREDIT_CDE IN ('001', '002', '004')
		AND SDW_COMP_ID NOT IN (SELECT SDW_COMP_ID FROM SDW_COMPONENTS_LEN)
		GROUP BY WW_CDE
		),

		DR_LEN(WW_CDE, BILLING_RATE, TOTAL) AS (
		SELECT WW_CDE, 
		SUM(BILLING_RATE * TRANSACTION_CNT) AS BILLING_RATE,
		VALUE(CAST(SUM(TRANSACTION_CNT) AS INTEGER), 0) AS TOTAL
		FROM LENOVO.DR_DETAIL_CR
		WHERE PERIOD_END_DTE IN (SELECT PERIOD_END_DTE FROM TARGET_PERIOD) 
		AND STATUS = 'CREDIT'
		AND COUNTRY_CDE = '649'
		AND CREDIT_CDE IN ('001', '002', '004')
		AND SDW_COMP_ID NOT IN (SELECT SDW_COMP_ID FROM SDW_COMPONENTS_LEN)
		GROUP BY WW_CDE
		),

		PL_ALL_LEN (WW_CDE, BILLING_RATE, TOTAL, PART_COST) AS (
		SELECT WW_CDE, 
		SUM(BILLING_RATE * TRANSACTION_CNT) AS BILLING_RATE,
		VALUE(CAST(SUM(TRANSACTION_CNT) AS INTEGER), 0) AS TOTAL,
		SUM(PART_COST)
		FROM LENOVO.PL_DETAIL_CR
		WHERE PERIOD_END_DTE IN (SELECT PERIOD_END_DTE FROM TARGET_PERIOD) 
		AND STATUS = 'CREDIT'
		AND COUNTRY_CDE = '649'
		AND CREDIT_CDE IN ('001', '002', '004')
		AND SDW_COMP_ID NOT IN (SELECT SDW_COMP_ID FROM SDW_COMPONENTS_LEN)
		GROUP BY WW_CDE
		),

		PL_ALL_BYSDW_LEN (SDW_COMP_ID, CDN_SDW_COMP_DESC, PART_COST)  AS (
		SELECT B.SDW_COMP_ID,
		B.CDN_SDW_COMP_DESC,
		CAST (SUM(A.PART_COST) AS DECIMAL(15,7))
		FROM PL_ALL_LEN A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'Y' = B.LENOVO_INT
		LEFT JOIN WW_CODE_REF C ON A.WW_CDE = C.WW_CDE
		GROUP BY B.SDW_COMP_ID, C.US_BILL_GRP, B.CDN_SDW_COMP_DESC
		),

		SUB1(SUBPOS, DESC) AS (
		VALUES (1, 'Customer Number:  00788968    Using Bill Number 03 for Maintenance'),
		(2, 'Contract Number:  P0078528'),
		(3, 'Customer Reference:  Tony Pasquale'),
		(4, 'BILLING PERIOD:  ' || (SELECT MONTHNAME(PERIOD_START_DTE) || ' ' || CAST(DAY(PERIOD_START_DTE) AS CHAR(2)) || ', ' || CAST(YEAR(PERIOD_START_DTE) AS CHAR(4)) || '    TO    ' || MONTHNAME(PERIOD_END_DTE) || ' ' || CAST(DAY(PERIOD_END_DTE) AS CHAR(2)) || ', ' || CAST(YEAR(PERIOD_END_DTE) AS CHAR(4))FROM LENOVO.PERIOD_DATES WHERE PERIOD_END_DTE = (SELECT MAX(PERIOD_END_DTE) FROM LENOVO.PERIOD_DATES WHERE LEN_DATA_REC = 'Y' ))),
		(5, ' ')
		),

		SUB2(SUBPOS, DESC) AS (
		VALUES (1, '.'),
		(2, 'DESCRIPTION:  REMOTE CUSTOMER SUPPORT'),
		(3, '.'),
		(4, 'REMOTE CUSTOMER SUPPORT                                    AMOUNT DUE'),
		(5, '---------------------------------------------------------------------')
		),

		SUB3(SUBPOS, DESC) AS (
		SELECT
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ')  || '                  ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(SUM(A.BILLING_RATE)), '0'), 11, ' ')  AS DESC
		FROM RCS_IBM A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'N' = B.LENOVO_INT 
		LEFT JOIN WW_CODE_REF C ON A.WW_CDE = C.WW_CDE
		GROUP BY B.SDW_COMP_ID, C.US_BILL_GRP, B.CDN_SDW_COMP_DESC ORDER BY B.SDW_COMP_ID
		),

		SUB4(SUBPOS, DESC) AS (
		VALUES (1, '.'),
		(2, 'DESCRIPTION: ON-SITE BREAK FIX SERVICE'),
		(3, '.'),
		(4, 'ON-SITE BREAK FIX SERVICE                                  AMOUNT DUE'),
		(5, '---------------------------------------------------------------------')
		),

		SUB5(SUBPOS, DESC) AS (
		SELECT
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ')  || '                  ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(SUM(A.BILLING_RATE)), '0'), 11, ' ')  AS DESC
		FROM BF_IBM A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'N' = B.LENOVO_INT 
		LEFT JOIN WW_CODE_REF C ON A.WW_CDE = C.WW_CDE
		GROUP BY B.SDW_COMP_ID, C.US_BILL_GRP, B.CDN_SDW_COMP_DESC ORDER BY B.SDW_COMP_ID
		),

		SUB6(SUBPOS, DESC) AS (
		VALUES (1, '.'),
		(2, 'DESCRIPTION: PARTS LOGISTICS AND MANAGEMENT SERVICES'),
		(3, '.'),
		(4, 'PARTS LOGISTICS AND MANAGEMENT                             AMOUNT DUE'),
		(5, '---------------------------------------------------------------------')
		),


		SUB7(SUBPOS, DESC) AS (
		SELECT
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ')  || '                  ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(SUM(A.BILLING_RATE)), '0'), 11, ' ')  AS DESC
		FROM PL_ALL_IBM A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'N' = B.LENOVO_INT 
		LEFT JOIN WW_CODE_REF C ON A.WW_CDE = C.WW_CDE
		WHERE RATE_LOOKUP = 'Y'
		GROUP BY B.SDW_COMP_ID, C.US_BILL_GRP, B.CDN_SDW_COMP_DESC ORDER BY B.SDW_COMP_ID
		),

		SUB8 (SUBPOS, DESC)  AS (
		SELECT
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ')  || '                  ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(CAST(ROUND(SUM(A.PART_COST), 2) AS DECIMAL(15,2))), '0'), 11, ' ')  AS DESC
		FROM PL_ALL_IBM A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'N' = B.LENOVO_INT
		LEFT JOIN WW_CODE_REF C ON A.WW_CDE = C.WW_CDE
		WHERE B.SDW_COMP_ID NOT IN ('C0001297', 'C0001299')
		AND RATE_LOOKUP = 'N'
		GROUP BY B.SDW_COMP_ID, C.US_BILL_GRP, B.CDN_SDW_COMP_DESC ORDER BY B.SDW_COMP_ID
		),

		SUB9(SUBPOS, DESC) AS (
		VALUES (1, '.'),
		(2, 'DESCRIPTION: DEPOT REPAIR FEES'),
		(3, '.'),
		(4, 'DEPOT REPAIR FEES                                          AMOUNT DUE'),
		(5, '---------------------------------------------------------------------')
		),

		SUB10(SUBPOS, DESC) AS (
		SELECT
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ')  || '                  ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(SUM(A.BILLING_RATE)), '0'), 11, ' ')  AS DESC
		FROM DR_IBM A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'N' = B.LENOVO_INT 
		LEFT JOIN WW_CODE_REF C ON A.WW_CDE = C.WW_CDE
		GROUP BY B.SDW_COMP_ID, C.US_BILL_GRP, B.CDN_SDW_COMP_DESC ORDER BY B.SDW_COMP_ID
		),

		SUB11(SUBPOS, DESC) AS (
		SELECT 
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ')  || '                  ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(CAST(ROUND(SUM(A.PART_COST), 2) AS DECIMAL(15,2))), '0'), 11, ' ')  AS DESC
		FROM PL_ALL_IBM A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'N' = B.LENOVO_INT
		LEFT JOIN WW_CODE_REF C ON A.WW_CDE = C.WW_CDE
		WHERE B.SDW_COMP_ID IN ('C0001299')
		GROUP BY B.SDW_COMP_ID, C.US_BILL_GRP, B.CDN_SDW_COMP_DESC
		),

		SUB12(SUBPOS, DESC) AS (
		VALUES (1, '.'),
		(2, 'Lenovo Internal Employee (Taxable)')
		),

		SUB13(SUBPOS, DESC) AS (
		VALUES (1, '.'),
		(2, 'DESCRIPTION:  REMOTE CUSTOMER SUPPORT'),
		(3, '.'),
		(4, 'REMOTE CUSTOMER SUPPORT                                    AMOUNT DUE'),
		(5, '---------------------------------------------------------------------')
		),


		SUB14(SUBPOS, DESC) AS (
		SELECT
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ')  || '                  ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(SUM(A.BILLING_RATE)), '0'), 11, ' ')  AS DESC
		FROM RCS_LEN A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'Y'= B.LENOVO_INT 
		LEFT JOIN WW_CODE_REF C ON A.WW_CDE = C.WW_CDE
		GROUP BY B.SDW_COMP_ID, C.US_BILL_GRP, B.CDN_SDW_COMP_DESC ORDER BY B.SDW_COMP_ID
		),

		SUB15(SUBPOS, DESC) AS (
		VALUES (1, '.'),
		(2, 'DESCRIPTION: ON-SITE BREAK FIX SERVICE'),
		(3, '.'),
		(4, 'ON-SITE BREAK FIX SERVICE                                  AMOUNT DUE'),
		(5, '---------------------------------------------------------------------')
		),

		SUB16(SUBPOS, DESC) AS (
		SELECT
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ')  || '                  ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(SUM(A.BILLING_RATE)), '0'), 11, ' ')  AS DESC
		FROM BF_LEN A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'Y'= B.LENOVO_INT 
		LEFT JOIN WW_CODE_REF C ON A.WW_CDE = C.WW_CDE
		GROUP BY B.SDW_COMP_ID, C.US_BILL_GRP, B.CDN_SDW_COMP_DESC ORDER BY B.SDW_COMP_ID
		),

		SUB17(SUBPOS, DESC) AS (
		VALUES (1, '.'),
		(2, 'DESCRIPTION: PARTS LOGISTICS AND MANAGEMENT SERVICES'),
		(3, '.'),
		(4, 'PARTS LOGISTICS AND MANAGEMENT                             AMOUNT DUE'),
		(5, '---------------------------------------------------------------------')
		),

		SUB18(SUBPOS, DESC) AS (
		SELECT
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ')  || '                  ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(SUM(A.BILLING_RATE)), '0'), 11, ' ')  AS DESC
		FROM PL_ALL_LEN A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'Y' = B.LENOVO_INT 
		LEFT JOIN WW_CODE_REF C ON A.WW_CDE = C.WW_CDE
		WHERE RATE_LOOKUP = 'Y'
		GROUP BY B.SDW_COMP_ID, C.US_BILL_GRP, B.CDN_SDW_COMP_DESC ORDER BY B.SDW_COMP_ID
		),

		SUB19(SUBPOS, DESC)  AS (
		SELECT
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ')  || '                  ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(CAST(ROUND(SUM(A.PART_COST), 2) AS DECIMAL(15,2))), '0'), 11, ' ')  AS DESC
		FROM PL_ALL_LEN A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'Y' = B.LENOVO_INT
		LEFT JOIN WW_CODE_REF C ON A.WW_CDE = C.WW_CDE
		WHERE B.SDW_COMP_ID NOT IN ('C0001372', 'C0001373')
		AND RATE_LOOKUP = 'N'
		GROUP BY B.SDW_COMP_ID, C.US_BILL_GRP, B.CDN_SDW_COMP_DESC ORDER BY B.SDW_COMP_ID
		),

		SUB20(SUBPOS, DESC) AS (
		VALUES (1, '.'),
		(2, 'DESCRIPTION: DEPOT REPAIR FEES'),
		(3, '.'),
		(4, 'DEPOT REPAIR FEES                                          AMOUNT DUE'),
		(5, '---------------------------------------------------------------------')
		),

		SUB21(SUBPOS, DESC) AS (
		SELECT
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ')  || '                  ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(SUM(A.BILLING_RATE)), '0'), 11, ' ')  AS DESC
		FROM DR_LEN A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'Y' = B.LENOVO_INT 
		LEFT JOIN WW_CODE_REF C ON A.WW_CDE = C.WW_CDE
		GROUP BY B.SDW_COMP_ID, C.US_BILL_GRP, B.CDN_SDW_COMP_DESC ORDER BY B.SDW_COMP_ID
		),

		SUB22(SUBPOS, DESC) AS (
		SELECT 
		1,
		LENOVO.RPAD(CAST(B.CDN_SDW_COMP_DESC AS CHAR(40)), 40, ' ')  || '                  ' || LENOVO.LPAD('$' || LENOVO.LTRIMC(CHAR(CAST(ROUND(SUM(A.PART_COST), 2) AS DECIMAL(15,2))), '0'), 11, ' ')  AS DESC
		FROM PL_ALL_LEN A LEFT JOIN LENOVO.SDW_COMPONENTS B ON A.WW_CDE = B.WW_CDE AND 'Y' = B.LENOVO_INT
		LEFT JOIN WW_CODE_REF C ON A.WW_CDE = C.WW_CDE
		WHERE B.SDW_COMP_ID IN ('C0001373')
		GROUP BY B.SDW_COMP_ID, C.US_BILL_GRP, B.CDN_SDW_COMP_DESC
		),

		OUTPUT_ALL(POS, SUBPOS, HEADER, DESC) AS (
		SELECT 1 AS POS, SUBPOS, 1, CAST(DESC AS CHAR(69)) FROM SUB1 UNION ALL 
		SELECT 2 AS POS, SUBPOS, 0, CAST(DESC AS CHAR(69)) FROM SUB2 UNION ALL
		SELECT 3 AS POS, SUBPOS, 2,CAST(DESC AS CHAR(69)) FROM SUB3 UNION ALL
		SELECT 4 AS POS, SUBPOS, 0, CAST(DESC AS CHAR(69)) FROM SUB4 UNION ALL
		SELECT 5 AS POS, SUBPOS, 4, CAST(DESC AS CHAR(69)) FROM SUB5 UNION ALL
		SELECT 6 AS POS, SUBPOS, 0, CAST(DESC AS CHAR(69)) FROM SUB6 UNION ALL
		SELECT 7 AS POS, SUBPOS, 6, CAST(DESC AS CHAR(69)) FROM SUB7 UNION ALL
		SELECT 8 AS POS, SUBPOS, 6, CAST(DESC AS CHAR(69)) FROM SUB8 UNION ALL
		SELECT 9 AS POS, SUBPOS, 0, CAST(DESC AS CHAR(69)) FROM SUB9 UNION ALL
		SELECT 10 AS POS, SUBPOS, 9, CAST(DESC AS CHAR(69)) FROM SUB10 UNION ALL
		SELECT 11 AS POS, SUBPOS, 9, CAST(DESC AS CHAR(69)) FROM SUB11 UNION ALL
		SELECT 12 AS POS, SUBPOS, -1, CAST(DESC AS CHAR(69)) FROM SUB12 UNION ALL
		SELECT 13 AS POS, SUBPOS, 0, CAST(DESC AS CHAR(69)) FROM SUB13 UNION ALL
		SELECT 14 AS POS, SUBPOS, 13, CAST(DESC AS CHAR(69)) FROM SUB14 UNION ALL
		SELECT 15 AS POS, SUBPOS, 0, CAST(DESC AS CHAR(69)) FROM SUB15 UNION ALL
		SELECT 16 AS POS, SUBPOS, 15, CAST(DESC AS CHAR(69)) FROM SUB16 UNION ALL
		SELECT 17 AS POS, SUBPOS, 0, CAST(DESC AS CHAR(69)) FROM SUB17 UNION ALL
		SELECT 18 AS POS, SUBPOS, 17, CAST(DESC AS CHAR(69)) FROM SUB18 UNION ALL
		SELECT 19 AS POS, SUBPOS, 17, CAST(DESC AS CHAR(69)) FROM SUB19 UNION ALL
		SELECT 20 AS POS, SUBPOS, 0, CAST(DESC AS CHAR(69)) FROM SUB20 UNION ALL
		SELECT 21 AS POS, SUBPOS, 20, CAST(DESC AS CHAR(69)) FROM SUB21 UNION ALL
		SELECT 22 AS POS, SUBPOS, 20, CAST(DESC AS CHAR(69)) FROM SUB22		
		),

		DISPLAY_HEADERS(DIS_HEADER) AS (
		SELECT DISTINCT HEADER FROM OUTPUT_ALL
		)


		SELECT CASE WHEN A.POS &gt; 1 THEN UCASE(A.DESC) ELSE A.DESC END 
		FROM OUTPUT_ALL A LEFT JOIN DISPLAY_HEADERS B ON A.POS = B.DIS_HEADER
		WHERE A.HEADER &gt; 0 OR B.DIS_HEADER &gt; 0 OR 
		(A.HEADER = -1 AND ((SELECT COUNT(*) FROM DISPLAY_HEADERS WHERE DIS_HEADER &gt; 12)  &gt; 0))
		ORDER BY A.POS, A.SUBPOS
		
	"/>
      </subReport>
            
  </multiReport>    

</reports>
